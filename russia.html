<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Russia Free SMS Numbers</title>
  <!-- Tailwind CSS CDN for quick styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Custom styles for the app */
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f3f4f6; /* Light gray background */
    }
    .header-bg {
      background-color: #1a73e8; /* Google Blue */
    }
    .nav-bg {
      background-color: #333;
    }
    .number-box {
      transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }
    .number-box:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    }
    .receive-button {
      background-color: #28a745; /* Green */
      transition: background-color 0.2s ease-in-out;
    }
    .receive-button:hover {
      background-color: #218838;
    }
    .pagination-button {
      background-color: #4a5568; /* Dark gray */
      transition: background-color 0.2s ease-in-out;
    }
    .pagination-button:hover {
      background-color: #2d3748;
    }
    /* Ad containers - to collapse when empty */
    .ad-slot {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      text-align: center;
      width: 100%;
      /* Transition for smooth collapse/expand */
      transition: max-height 0.5s ease-out, opacity 0.5s ease-out, margin 0.5s ease-out;
      overflow: hidden; /* Hide overflow during collapse */
      max-height: 500px; /* Max height when ads are present */
      opacity: 1;
      margin-top: 20px;
      margin-bottom: 20px;
    }
    /* State for collapsed ad slot */
    .ad-slot.collapsed {
      max-height: 0;
      margin-top: 0;
      margin-bottom: 0;
      opacity: 0;
    }

    .ad-slot iframe {
      border: none;
      display: block; /* Ensure it behaves like a block element */
      overflow: hidden; /* Hide overflow within iframe */
      /* Initial state for iframe, will be adjusted by JS */
      width: 1px;
      height: 1px;
      opacity: 0;
      transition: width 0.5s ease-out, height 0.5s ease-out, opacity 0.5s ease-out;
    }

    /* Specific styling for the native ad grid container */
    #native-ad-slot.grid-container {
      display: grid;
      /* Adjusted to support a single ad, but can still flex for multiple if needed */
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1rem; /* Space between ads */
      justify-items: center; /* Center ads within their grid cells */
      align-items: flex-start;
    }
    /* For native ad iframes within the grid */
    #native-ad-slot.grid-container iframe {
        width: 1px; /* Initial small width */
        height: 1px; /* Initial small height */
        opacity: 0;
    }

    .direct-link-container {
      margin-top: 15px;
      margin-bottom: 30px;
      text-align: center;
    }
    .direct-link-container a {
      color: #1a73e8;
      font-weight: bold;
      text-decoration: underline;
    }
    .loading-spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      display: inline-block;
      vertical-align: middle;
      margin-left: 10px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>

  <!-- Popunder Adsterra Code (Moved to head for quicker loading) -->
  <script type='text/javascript' src='//pl27076189.profitableratecpm.com/bd/9d/a0/bd9da0ea1fb5ebaf0db6f76aa02c0300.js'></script>
  <!-- End Popunder Adsterra Code -->

</head>
<body class="min-h-screen flex flex-col">

  <!-- Header Section -->
  <header class="header-bg text-white p-6 text-center text-3xl font-bold rounded-b-lg shadow-md">
    Russia Free SMS Box
  </header>

  <!-- Navigation Bar -->
  <nav class="nav-bg p-4 text-center shadow-sm">
    <a href="index.html" class="text-white mx-4 text-lg font-semibold hover:text-blue-200 transition-colors">Home</a>
    <a href="#" class="text-white mx-4 text-lg font-semibold hover:text-blue-200 transition-colors">About Us</a>
    <a href="#" class="text-white mx-4 text-lg font-semibold hover:text-blue-200 transition-colors">Contact</a>
  </nav>

  <main class="flex-grow container mx-auto p-6">
    <h3 class="text-3xl font-bold text-gray-800 mb-6 text-center">ðŸ“± Choose a Temporary Number for Russia</h3>

    <!-- Adsterra Native Banner (Above the numbers container) -->
    <!-- This slot is configured to load the specific Adsterra native ad. -->
    <div id="native-ad-slot" class="ad-slot mx-auto grid-container">
      <!-- Ad Code will be inserted here by JavaScript -->
    </div>
    <!-- End Adsterra Native Banner -->

    <!-- Numbers Container -->
    <div id="numbers-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 my-10">
      <!-- Numbers will be rendered here by JavaScript -->
    </div>

    <!-- Gemini API Feature: SMS Content Suggestion -->
    <div class="bg-white p-6 rounded-xl shadow-lg my-10">
      <h4 class="text-2xl font-bold text-gray-800 mb-4 text-center">âœ¨ Draft SMS (AI-Powered)</h4>
      <p class="text-gray-600 mb-4 text-center">Write an idea for your SMS message and let AI draft it.</p>
      <textarea id="smsPrompt" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4" rows="3" placeholder="e.g., 'Need verification code', 'Meeting reminder', 'Quick reply'"></textarea>
      <button onclick="generateSmsDraft()" class="w-full bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold shadow-md hover:bg-blue-700 transition-colors flex items-center justify-center">
        <span id="generateButtonText">âœ¨ Draft SMS</span>
        <span id="loadingSpinner" class="loading-spinner hidden"></span>
      </button>
      <div id="smsOutput" class="mt-6 p-4 bg-gray-100 rounded-md text-gray-800 border border-gray-200 hidden">
        <p class="font-semibold mb-2">Generated SMS:</p>
        <p id="smsContent"></p>
      </div>
      <div id="errorMessage" class="mt-4 p-3 bg-red-100 text-red-700 rounded-md hidden"></div>
    </div>

    <!-- Adsterra Banner 300x250 (Above the direct link) -->
    <div id="banner-300x250-ad-slot" class="ad-slot mx-auto">
      <!-- Iframe for Banner 300x250 Ad Code will be inserted here by JavaScript -->
    </div>

    <!-- Direct Link Text Below Banner -->
    <div class="direct-link-container">
      <p>
        <a href="https://www.profitableratecpm.com/rpyik3mwtc?key=2d55950f1a1ec397c4aa2852ea2ae6a6" target="_blank">
          Click here to see our other services!
        </a>
      </p>
    </div>

    <!-- Pagination Buttons -->
    <div class="flex justify-center space-x-4 mt-10">
      <button onclick="prevPage()" class="pagination-button text-white px-6 py-3 rounded-lg font-semibold shadow-md hover:shadow-lg transition-all duration-200">Previous</button>
      <button onclick="nextPage()" class="pagination-button text-white px-6 py-3 rounded-lg font-semibold shadow-md hover:shadow-lg transition-all duration-200">Next</button>
    </div>
  </main>

  <!-- Footer Section -->
  <footer class="bg-gray-800 text-white p-6 text-center text-sm mt-10 rounded-t-lg shadow-md">
    &copy; 2025 Free SMS Box. All rights reserved.
  </footer>

  <script>
    const numbers = [];

    // Function to generate a random number of specified length
    function getRandomNumber(length) {
      let result = '';
      const characters = '0123456789';
      const charactersLength = characters.length;
      for (let i = 0; i < length; i++) {
        result += characters.charAt(Math.floor(Math.random() * charactersLength));
      }
      return result;
    }

    // Generate 60 unique dummy Russian numbers (+7 9XX XXX XX XX format)
    const generatedNumbers = new Set();
    // Russian mobile numbers typically start with +7 9, followed by 9 digits.
    const prefixes = ['900', '901', '902', '903', '904', '905', '906', '908', '909', '910', '911', '912', '913', '914', '915', '916', '917', '918', '919', '920', '921', '922', '923', '924', '925', '926', '927', '928', '929', '930', '931', '932', '933', '934', '936', '937', '938', '939', '940', '941', '942', '943', '944', '945', '946', '947', '948', '949', '950', '951', '952', '953', '954', '955', '956', '957', '958', '959', '960', '961', '962', '963', '964', '965', '966', '967', '968', '969', '970', '971', '972', '973', '974', '975', '976', '977', '978', '979', '980', '981', '982', '983', '984', '985', '987', '988', '989', '990', '991', '992', '993', '994', '995', '996', '997', '998', '999'];
    while (generatedNumbers.size < 60) {
      const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];
      const remainingDigits = getRandomNumber(7); // 7 digits for the rest of the number
      const fullNumber = `+7 ${prefix} ${remainingDigits.substring(0,3)} ${remainingDigits.substring(3,5)} ${remainingDigits.substring(5,7)}`;
      generatedNumbers.add(fullNumber);
    }

    // Convert Set to Array and populate the 'numbers' array
    numbers.push(...Array.from(generatedNumbers).map(num => ({
      num: num,
      flagUrl: 'https://flagcdn.com/ru.svg', // Russia flag
      country: 'Russia'
    })));

    // Function to shuffle an array (Fisher-Yates algorithm)
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]]; // Swap elements
      }
    }

    // Shuffle the numbers array initially
    shuffleArray(numbers);

    let currentPage = 1;
    const numbersPerPage = 12; // Display 12 numbers per page

    // Define ad configurations
    const adConfigs = {
      // Native ad configuration for the specific ad code provided by the user
      native: {
        scripts: [
          { async: true, 'data-cfasync': false, src: '//pl27076176.profitableratecpm.com/36c71a4fca369dbf689c31baada8259d/invoke.js' }
        ],
        divs: [
          { id: 'container-36c71a4fca369dbf689c31baada8259d' }
        ],
        // These dimensions are approximate; the ad itself will determine its final size.
        height: 250,
        width: 300
      },
      // Consistent 300x250 banner (re-added at the bottom)
      banner300x250: {
        key: 'a9e0e31759b1f80164727452baf12b70',
        height: 250,
        width: 300
      }
    };

    /**
     * Loads an advertisement within an iframe to isolate its scripts and prevent layout shifts.
     * @param {string} containerId - The ID of the HTML element where the iframe will be appended.
     * @param {object} adConfig - Configuration object for the ad (contains scripts/divs for native, or key/dimensions for others).
     */
    function loadAdInIframe(containerId, adConfig) {
      const container = document.getElementById(containerId);
      if (!container) return;

      // Ensure the parent container is not collapsed initially
      container.classList.remove('collapsed');

      // Clear existing iframe if any to ensure a fresh load
      container.innerHTML = '';

      const iframes = []; // Keep track of created iframes

      // For native ads, we need to create multiple iframes, one for each ad
      // This loop will now run only only once for the 'native' adConfig as it has only one script/div.
      if (adConfig.scripts && adConfig.divs && containerId === 'native-ad-slot') {
        adConfig.divs.forEach((divData, index) => {
          const iframe = document.createElement('iframe');
          iframe.style.width = '1px'; // Start with minimal size
          iframe.style.height = '1px';
          iframe.style.opacity = '0'; // Hide initially
          iframe.style.border = 'none';
          iframe.style.overflow = 'hidden';
          iframe.scrolling = 'no';
          iframe.setAttribute('loading', 'lazy');
          iframe.classList.add('native-ad-iframe');

          container.appendChild(iframe);
          iframes.push(iframe); // Add to tracking array

          const iframeDoc = iframe.contentWindow.document;
          iframeDoc.open();
          iframeDoc.write(`
            <!DOCTYPE html>
            <html>
            <head>
              <style>body { margin: 0; overflow: hidden; }</style>
            </head>
            <body>
              <div id="${divData.id}"></div>
            </body>
            </html>
          `);
          iframeDoc.close();

          const adDiv = iframeDoc.getElementById(divData.id);

          // Append the corresponding script for this native ad
          const scriptData = adConfig.scripts[index];
          if (scriptData) {
            const script = iframeDoc.createElement('script');
            script.type = 'text/javascript';
            if (scriptData.src) {
              script.src = scriptData.src;
              if (scriptData.async !== undefined) script.async = scriptData.async;
              if (scriptData['data-cfasync'] !== undefined) script.dataset.cfasync = scriptData['data-cfasync'];
            } else if (scriptData.textContent) {
              script.textContent = scriptData.textContent;
            }
            iframeDoc.body.appendChild(script);
          }
        });
      } else { // For single banner ads (like 300x250)
        const iframe = document.createElement('iframe');
        iframe.style.width = '1px'; // Start with minimal size
        iframe.style.height = '1px';
        iframe.style.opacity = '0'; // Hide initially
        iframe.style.border = 'none';
        iframe.style.overflow = 'hidden';
        iframe.scrolling = 'no';
        iframe.setAttribute('loading', 'lazy');

        container.appendChild(iframe);
        iframes.push(iframe); // Add to tracking array

        const iframeDoc = iframe.contentWindow.document;
        iframeDoc.open();
        iframeDoc.write(`
          <!DOCTYPE html>
          <html>
          <head>
            <style>body { margin: 0; overflow: hidden; }</style>
          </head>
          <body>
            <div id="ad-content-wrapper"></div>
          </body>
          </html>
        `);
        iframeDoc.close();

        const adContentWrapper = iframeDoc.getElementById('ad-content-wrapper');

        if (adConfig.key) { // For banners with key-based script
          const scriptOptions = iframeDoc.createElement('script');
          scriptOptions.type = 'text/javascript';
          scriptOptions.textContent = "atOptions = {" +
            "'key' : '" + adConfig.key + "'," +
            "'format' : 'iframe'," +
            "'height' : " + adConfig.height + "," +
            "'width' : " + adConfig.width + "," +
            "'params' : {}" +
            "};";
          adContentWrapper.appendChild(scriptOptions);

          const scriptInvoke = iframeDoc.createElement('script');
          scriptInvoke.type = 'text/javascript';
          scriptInvoke.src = `//www.highperformanceformat.com/${adConfig.key}/invoke.js`;
          adContentWrapper.appendChild(scriptInvoke);
        }
      }

      // Check if ads have loaded after a delay
      setTimeout(() => {
        let anyAdLoaded = false;
        iframes.forEach(iframe => {
          try {
            // Check if the iframe has gained significant height
            // A common ad size is 250px or 90px. If scrollHeight is very small, it's likely blocked.
            // We use contentWindow.document.body.scrollHeight to check content height within the iframe
            if (iframe.contentWindow && iframe.contentWindow.document && iframe.contentWindow.document.body.scrollHeight > 50) { // Threshold for a loaded ad
              iframe.style.width = `${adConfig.width}px`;
              iframe.style.height = `${adConfig.height}px`;
              iframe.style.opacity = '1'; // Make visible
              anyAdLoaded = true;
            } else {
              // Ad blocked or failed to load, collapse this specific iframe
              iframe.style.width = '0px';
              iframe.style.height = '0px';
              iframe.style.opacity = '0';
            }
          } catch (e) {
            // Cross-origin error, likely ad blocked or failed to load
            iframe.style.width = '0px';
            iframe.style.height = '0px';
            iframe.style.opacity = '0';
          }
        });

        // If no ads loaded in this container, collapse the container itself
        if (!anyAdLoaded) {
          container.classList.add('collapsed');
        } else {
          container.classList.remove('collapsed');
        }
      }, 1500); // Give ads 1.5 seconds to load
    }

    /**
     * Loads advertisements into their respective containers based on the current page.
     */
    function loadAds() {
      const nativeAdSlotContainer = document.getElementById('native-ad-slot');
      const banner300x250AdSlotContainer = document.getElementById('banner-300x250-ad-slot');

      // Clear existing content in both slots to prepare for new ads
      if (nativeAdSlotContainer) {
        nativeAdSlotContainer.innerHTML = '';
        nativeAdSlotContainer.classList.add('collapsed'); // Collapse initially
      }
      if (banner300x250AdSlotContainer) {
        banner300x250AdSlotContainer.innerHTML = '';
        banner300x250AdSlotContainer.classList.add('collapsed'); // Collapse initially
      }

      // Logic for the top ad slot (native-ad-slot) - always load the specific native ad
      if (nativeAdSlotContainer) {
        loadAdInIframe('native-ad-slot', adConfigs.native);
      }

      // Logic for the consistent 300x250 banner ad (bottom ad)
      if (banner300x250AdSlotContainer) {
        loadAdInIframe('banner-300x250-ad-slot', adConfigs.banner300x250);
      }
    }

    /**
     * Attaches event listeners to all "Receive SMS" buttons.
     */
    function attachReceiveSmsListeners() {
      document.querySelectorAll('.receive-button').forEach(button => {
        button.removeEventListener('click', handleReceiveSmsClick); // Remove existing to prevent duplicates
        button.addEventListener('click', handleReceiveSmsClick);
      });
    }

    /**
     * Renders the numbers for the current page in the numbers container.
     */
    function renderNumbers() {
      const start = (currentPage - 1) * numbersPerPage; // Starting index for slicing the numbers array
      const end = start + numbersPerPage; // Ending index for slicing
      const currentNumbers = numbers.slice(start, end);

      const numbersContainer = document.getElementById('numbers-container');
      // Ensure numbersContainer exists before trying to set innerHTML
      if (numbersContainer) {
        // Generate HTML for each number box and join them
        numbersContainer.innerHTML = currentNumbers.map(item => `
          <div class="number-box bg-white p-6 rounded-xl shadow-lg flex flex-col items-center justify-between">
            <div class="flex items-center mb-4">
              <img src="${item.flagUrl}" alt="Flag of ${item.country}" class="w-10 h-6 rounded-md mr-3 shadow-sm">
              <span class="text-lg font-bold text-gray-800">${item.country}</span>
            </div>
            <div class="text-lg text-gray-600 mb-6">${item.num}</div>
            <!-- Link to the new receive SMS page with data-number attribute -->
            <a href="#" class="receive-button text-white px-6 py-3 rounded-lg font-semibold shadow-md hover:shadow-lg transition-all duration-200" data-number="${item.num}">Receive SMS</a>
          </div>
        `).join('');
        
        // Re-attach event listeners after new elements are rendered
        attachReceiveSmsListeners();

      } else {
        console.error("Error: 'numbers-container' element not found.");
      }
    }

    /**
     * Navigates to the next page of numbers and reloads ads.
     */
    function nextPage() {
      if (currentPage < Math.ceil(numbers.length / numbersPerPage)) {
        currentPage++;
        renderNumbers();
        loadAds(); // Reload ads on page change
        window.scrollTo({ top: 0, behavior: 'smooth' }); // Scroll to top on page change
      }
    }

    /**
     * Navigates to the previous page of numbers and reloads ads.
     */
    function prevPage() {
      if (currentPage > 1) {
        currentPage--;
        renderNumbers();
        loadAds(); // Reload ads on page change
        window.scrollTo({ top: 0, behavior: 'smooth' }); // Scroll to top on page change
      }
    }

    /**
     * Gemini API Integration for SMS Drafting.
     * Generates an SMS draft based on user prompt using Google's Gemini API.
     */
    async function generateSmsDraft() {
      const smsPrompt = document.getElementById('smsPrompt').value;
      const smsOutputDiv = document.getElementById('smsOutput');
      const smsContentP = document.getElementById('smsContent');
      const errorMessageDiv = document.getElementById('errorMessage');
      const generateButtonText = document.getElementById('generateButtonText');
      const loadingSpinner = document.getElementById('loadingSpinner');

      // Clear previous output and errors
      smsOutputDiv.classList.add('hidden');
      smsContentP.textContent = '';
      errorMessageDiv.classList.add('hidden');
      errorMessageDiv.textContent = '';

      if (!smsPrompt.trim()) {
        errorMessageDiv.textContent = 'Please enter an idea for the SMS message.';
        errorMessageDiv.classList.remove('hidden');
        return;
      }

      // Show loading indicator
      generateButtonText.textContent = 'Generating...';
      loadingSpinner.classList.remove('hidden');

      try {
        let chatHistory = [];
        chatHistory.push({ role: "user", parts: [{ text: `Draft a concise SMS message based on the following idea: "${smsPrompt}". Provide only the SMS message, no additional explanations or introductions.` }] });
        const payload = { contents: chatHistory };
        const apiKey = ""; // Canvas will automatically provide the API key
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });

        const result = await response.json();

        if (result.candidates && result.candidates.length > 0 &&
            result.candidates[0].content && result.candidates[0].content.parts &&
            result.candidates[0].content.parts.length > 0) {
          const text = result.candidates[0].content.parts[0].text;
          smsContentP.textContent = text;
          smsOutputDiv.classList.remove('hidden');
        } else {
          errorMessageDiv.textContent = 'Failed to generate SMS draft. Please try again.';
          errorMessageDiv.classList.remove('hidden');
          console.error("Gemini API response structure unexpected:", result);
        }
      } catch (error) {
        errorMessageDiv.textContent = 'Error calling API: ' + error.message;
        errorMessageDiv.classList.remove('hidden');
        console.error("Error calling Gemini API:", error);
      } finally {
        // Hide loading indicator
        generateButtonText.textContent = 'âœ¨ Draft SMS';
        loadingSpinner.classList.add('hidden');
      }
    }

    // Handle click on "Receive SMS" button
    function handleReceiveSmsClick(event) {
      // Prevent the default link behavior
      event.preventDefault();
      const number = event.target.dataset.number;
      
      // Open the direct link in a new tab first
      window.open('https://www.profitableratecpm.com/rpyik3mwtc?key=2d55950f1a1ec397c4aa2852ea2ae6a6', '_blank');
      
      // Construct the URL for the SMS receive page (changed to receive_sms_russia.html)
      const smsReceiveUrl = `receive_sms_russia.html?number=${encodeURIComponent(number)}`;
      
      // Use a temporary anchor element to trigger navigation
      const tempLink = document.createElement('a');
      tempLink.href = smsReceiveUrl;
      tempLink.style.display = 'none'; // Hide the link
      document.body.appendChild(tempLink);
      tempLink.click(); // Programmatically click the link
      document.body.removeChild(tempLink); // Clean up
    }

    // Initial render when the page loads
    document.addEventListener('DOMContentLoaded', () => {
      renderNumbers();
      loadAds(); // Load ads initially
    });
  </script>

  <!-- Social Bar Adsterra Code (usually placed at the end of body) -->
  <script type='text/javascript' src='//pl27076196.profitableratecpm.com/88/a6/4b/88a64b874b1a42ceee80beec24d7f611.js'></script>
  <!-- End Social Bar Adsterra Code -->

</body>
</html>
